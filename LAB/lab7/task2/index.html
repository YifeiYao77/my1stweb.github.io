<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>3D Object Viewer</title>
        <style>
            body {
                display: flex;
                margin: 0;
                padding: 0;
                font-family: Arial, sans-serif;
                height: 100vh;
                overflow: hidden;
            }
            #canvas-container {
                flex: 1;
                padding: 10px;
                overflow: hidden;
            }
            #controls {
                width: 300px;
                padding: 20px;
                background-color: #f0f0f0;
                border-left: 1px solid #ccc;
                height: calc(100vh - 40px);
                overflow-y: auto;
                overflow-x: hidden;
            }
            #controls div {
                margin-bottom: 20px;
            }
            #controls label {
                display: block;
                margin-bottom: 5px;
            }
            #controls input[type="radio"] {
                margin-right: 5px;
            }
            #controls input[type="range"] {
                width: 100%;
                margin-bottom: 10px;
            }
            #controls input[type="color"] {
                margin-top: 10px;
            }
            #controls h3 {
                margin-top: 25px;
                margin-bottom: 15px;
                font-size: 16px;
                border-bottom: 1px solid #ddd;
                padding-bottom: 5px;
            }
        </style>
        <script id="vertex-shader" type="x-shader/x-vertex">
            #version 300 es
            in vec4 vPosition;
            in vec4 vColor;
            in vec3 vNormal;
            
            out vec4 aColor;
            out vec3 vNormalView;
            out vec3 vPositionView;
            
            uniform mat4 modelViewMatrix;
            uniform mat4 projectionMatrix;
            uniform mat3 normalMatrix;
            
            void main()
            {
                // Transform position to view space
                vec4 positionView = modelViewMatrix * vPosition;
                vPositionView = positionView.xyz;
                
                // Transform normal to view space
                vNormalView = normalize(normalMatrix * vNormal);
                
                gl_Position = projectionMatrix * positionView;
                gl_Position.z = -gl_Position.z;
                aColor = vColor;
            }
        </script>
        
        <script id="fragment-shader" type="x-shader/x-fragment">
            #version 300 es
            precision mediump float;
            
            in vec4 aColor;
            in vec3 vNormalView;
            in vec3 vPositionView;
            
            out vec4 fColor;
            
            // Material properties
            uniform vec3 materialAmbient;
            uniform vec3 materialDiffuse;
            uniform vec3 materialSpecular;
            uniform float materialShininess;
            
            // Light properties
            uniform vec3 lightPosition;
            uniform vec3 lightAmbient;
            uniform vec3 lightDiffuse;
            uniform vec3 lightSpecular;
            
            void main()
            {
                // Normalize the normal vector
                vec3 N = normalize(vNormalView);
                
                // Calculate light direction (from surface to light)
                vec3 L = normalize(lightPosition - vPositionView);
                
                // Calculate view direction (from surface to camera)
                vec3 V = normalize(-vPositionView);
                
                // Calculate reflection vector
                vec3 R = reflect(-L, N);
                
                // Calculate ambient component
                vec3 ambient = materialAmbient * lightAmbient;
                
                // Calculate diffuse component
                float NdotL = max(dot(N, L), 0.0);
                vec3 diffuse = materialDiffuse * NdotL * lightDiffuse;
                
                // Calculate specular component
                float RdotV = max(dot(R, V), 0.0);
                vec3 specular = materialSpecular * pow(RdotV, materialShininess) * lightSpecular;
                
                // Final color with material color applied
                vec3 finalColor = (ambient + diffuse) * aColor.rgb + specular;
                
                fColor = vec4(finalColor, 1.0);
            }
        </script>
        
        <script type="text/javascript" src="common/webgl-utils.js"></script>
        <script type="text/javascript" src="common/initShaders.js"></script>
        <script type="text/javascript" src="common/gl-matrix-min.js"></script>
        <script type="text/javascript" src="common/objloader.js"></script>
        <script type="text/javascript" src="js/complexobjview.js"></script>
    </head>
    <body>
        <div id="canvas-container">
            <canvas id="gl-canvas" width="1000" height="750">
                你的浏览器不支持HTML5 Canvas元素
            </canvas>
        </div>
        <div id="controls">
            <div>
                <label>选择一个OBJ模型文件</label>
                <input type="file" id="fileInput"><pre id="fileDisplay"></pre>
            </div>
            <div>
                <label>选择投影方式</label>
                <input type="radio" id="ortho" name="projtype" value="1" checked><label>正交投影</label>
                &nbsp;
                <input type="radio" id="persp" name="projtype" value="2"><label>透视投影</label>
            </div>
            <div>
                <label>选择绘制方式</label>
                <input type="radio" id="wire" name="drawtype" value="1" checked><label>线框模式</label>
                &nbsp;
                <input type="radio" id="solid" name="drawtype" value="2"><label>实体模式</label>
                <br>
                <label>颜色选择</label>
                <input type="color" id="objcolor" name="objcolor" value="#ff0000">
            </div>
            <div>
                <label>改变对象位置</label><input type="radio" id="objpos" name="posgrp" value="1" checked><label>物体位置</label>
                &nbsp;
                <input type="radio" id="campos" name="posgrp" value="2"><label>相机位置</label>
                <br>
                <label>x pos</label><input type="range" id="xpos" name="xpos" min="-5.0" max="5.0" step="0.1"> <br>
                <label>y pos</label><input type="range" id="ypos" name="ypos" min="-5.0" max="5.0" step="0.1"> <br>
                <label>z pos</label><input type="range" id="zpos" name="zpos" min="-5.0" max="5.0" step="0.1"> <br>
                <label>x rot</label><input type="range" id="xrot" name="xrot" min="-360" max="360" step="1.0"><br>
                <label>y rot</label><input type="range" id="yrot" name="yrot" min="-360" max="360" step="1.0"><br>
                <label>z rot</label><input type="range" id="zrot" name="zrot" min="-360" max="360" step="1.0">
            </div>
            
            <!-- 材质属性调节 -->
            <div>
                <h3>材质属性</h3>
                <label>环境光反射系数(Ka): <span id="kaValue">0.2</span></label>
                <input type="range" id="ka" name="ka" min="0.0" max="1.0" step="0.01" value="0.2"> <br>
                
                <label>漫反射系数(Kd): <span id="kdValue">0.8</span></label>
                <input type="range" id="kd" name="kd" min="0.0" max="1.0" step="0.01" value="0.8"> <br>
                
                <label>高光反射系数(Ks): <span id="ksValue">1.0</span></label>
                <input type="range" id="ks" name="ks" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
                
                <label>高光亮度系数(Shininess): <span id="shininessValue">32</span></label>
                <input type="range" id="shininess" name="shininess" min="1" max="256" step="1" value="32"> <br>
            </div>
            
            <!-- 材质颜色配置 -->
            <div>
                <h3>材质颜色</h3>
                <label>红色(R): <span id="matRValue">1.0</span></label>
                <input type="range" id="matR" name="matR" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
                
                <label>绿色(G): <span id="matGValue">1.0</span></label>
                <input type="range" id="matG" name="matG" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
                
                <label>蓝色(B): <span id="matBValue">1.0</span></label>
                <input type="range" id="matB" name="matB" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
            </div>
            
            <!-- 光源位置控制 -->
            <div>
                <h3>光源位置</h3>
                <label>X坐标: <span id="lightXValue">2.0</span></label>
                <input type="range" id="lightX" name="lightX" min="-10.0" max="10.0" step="0.1" value="2.0"> <br>
                
                <label>Y坐标: <span id="lightYValue">2.0</span></label>
                <input type="range" id="lightY" name="lightY" min="-10.0" max="10.0" step="0.1" value="2.0"> <br>
                
                <label>Z坐标: <span id="lightZValue">2.0</span></label>
                <input type="range" id="lightZ" name="lightZ" min="-10.0" max="10.0" step="0.1" value="2.0"> <br>
            </div>
            
            <!-- 光源颜色配置 -->
            <div>
                <h3>光源颜色</h3>
                <label>红色(R): <span id="lightRValue">1.0</span></label>
                <input type="range" id="lightR" name="lightR" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
                
                <label>绿色(G): <span id="lightGValue">1.0</span></label>
                <input type="range" id="lightG" name="lightG" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
                
                <label>蓝色(B): <span id="lightBValue">1.0</span></label>
                <input type="range" id="lightB" name="lightB" min="0.0" max="1.0" step="0.01" value="1.0"> <br>
            </div>
        </div>
    </body>
</html>